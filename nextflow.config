params {
    modbam            = null                // Path to modBAM file output by mod caller
    mod_type          = null                // Type of modification
    modkit            = null                // Path to modkit executable
    fasta             = null                // Reference fasta file for modkit
    ground_truth      = null                // Ground truth modification sites
    filter_thresholds = [0.5, 0.75, 0.9,
                         0.95, 0.99, 0.995] // filter_threshold values to test
    mod_thresholds    = [0.5, 0.75, 0.9,
                         0.95, 0.99, 0.995] // mod_threshold values to test
    outdir            = "results"           // Where to write results
    default_cpus      = 1                   // Default CPUs to request per process
    default_memory    = '8GB'               // Default memory to request per process
    default_time      = '1h'                // Default time to request per process
    filter_cpus       = 8                   // Default CPUs to request for samtools filter
    sort_cpus         = 8                   // Default CPUs to request for samtools sort
    index_cpus        = 4                   // Default CPUs to request for samtools index
    pileup_cpus       = 8                   // Default CPUs to request for modkit pileup
    pileup_memory     = '30GB'              // Default memory to request for modkit pileup
    pileup_time       = '1h'                // Default time to request for modkit pileup
    t2g_disk          = 5GB                 // Default job filesystem disk space to request for t2g
    hpc_queue         = 'normal'            // User to override this if running in HPC environ
    hpc_project       = 'abc'               // User to override this if running in HPC environ
    hpc_storage       = 'storage/path'      // User to override this if running in HPC environ
}

profiles {
    local {
        process.executor   = 'local'
        params.pileup_cpus = 2
        conda.enabled      = true
    }

    slurm {
        process.executor   = 'slurm'
        process.queue      = 'general'
        conda.enabled      = true
    }

    pbs {
        process {
            executor       = 'pbspro'

            // Default resources
            clusterOptions = '-q ${params.hpc_queue} -P ${params.hpc_project} -lstorage=${params.hpc_storage}'
            cpus           = params.default_cpus
            memory         = params.default_memory
            time           = params.default_time

            // Per-process overrides
            withName: 'SAMTOOLS_FILTER' {
                cpus       = params.filter_cpus
            }
            withName: 'SAMTOOLS_SORT' {
                cpus       = params.sort_cpus
            }
            withName: 'SAMTOOLS_INDEX' {
                cpus       = params.index_cpus
            }
            withName: 'MODKIT_PILEUP' {
                cpus       = params.pileup_cpus
                memory     = params.pileup_memory
                time       = params.pileup_time
            }
            withName: 'T2G' {
                clusterOptions = '-q ${params.hpc_queue} -P ${params.hpc_project} -lstorage=${params.hpc_storage} -ljobfs=${params.t2g_disk}'
            }
        }

        conda.enabled      = true
    }

    pbspro {
        process {
            executor       = 'pbspro'

            // Default resources
            clusterOptions = '-q ${params.hpc_queue} -P ${params.hpc_project} -lstorage=${params.hpc_storage}'
            cpus           = params.default_cpus
            memory         = params.default_memory
            time           = params.default_time

            // Per-process overrides
            withName: 'SAMTOOLS_FILTER' {
                cpus       = params.filter_cpus
            }
            withName: 'SAMTOOLS_SORT' {
                cpus       = params.sort_cpus
            }
            withName: 'SAMTOOLS_INDEX' {
                cpus       = params.index_cpus
            }
            withName: 'MODKIT_PILEUP' {
                cpus       = params.pileup_cpus
                memory     = params.pileup_memory
                time       = params.pileup_time
            }
            withName: 'T2G' {
                clusterOptions = '-q ${params.hpc_queue} -P ${params.hpc_project} -lstorage=${params.hpc_storage} -ljobfs=${params.t2g_disk}'
            }
        }

        conda.enabled      = true
    }

    // default profile
    standard {
        process.executor   = 'local'
        params.pileup_cpus = 2
        conda.enabled      = true
    }
}